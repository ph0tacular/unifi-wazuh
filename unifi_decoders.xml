<!-- Network App samples
Jul 30 05:18:58 udr7 CEF:0|Ubiquiti|UniFi Network|9.3.45|546|Admin Made Config Changes|2|UNIFIcategory=System UNIFIsubCategory=Admin UNIFIhost=udr7 UNIFIsettingsChanges=this_controller: false UNIFIaccessMethod=web UNIFIsettingsSection=SETTINGS_SYSTEM UNIFIsettingsEntry=rsyslogd UNIFIadmin=admin src=172.20.0.5 msg=admin made a change to  in System settings. Source IP: 172.20.0.5

Jul 30 05:35:34 udr7 CEF:0|Ubiquiti|UniFi Network|9.3.45|400|WiFi Client Connected|1|UNIFIcategory=Monitoring UNIFIsubCategory=WiFi UNIFIhost=udr7 UNIFIconnectedToDeviceName=udr7 UNIFIconnectedToDeviceIp=172.20.0.1 UNIFIconnectedToDeviceMac=1c:0b:8b:46:ff:11 UNIFIconnectedToDeviceModel=UDR7 UNIFIconnectedToDeviceVersion=4.2.15 UNIFIclientAlias=Apple iPhone 11:ff UNIFIclientIp=172.20.0.10 UNIFIclientMac=c2:ba:c4:27:11:ff UNIFIwifiChannel=60 UNIFIwifiChannelWidth=40 UNIFIwifiName=WIFIbaby UNIFIwifiBand=na UNIFIauthMethod=wpapsk UNIFIWiFiRssi=-68 UNIFInetworkName=Silo UNIFInetworkSubnet=172.20.0.0/24 UNIFInetworkVlan=3 msg=Apple iPhone 11:ff connected to WIFIbaby on udr7. Connection Info: Ch. 60 (5 GHz, 40 MHz), -68 dBm. IP: 172.20.0.5
-->

<decoder name="unifi">
  <program_name>CEF</program_name>
</decoder>

<!-- traffic (syslog) -->
<decoder name="unifi-lan2lan">
  <prematch>LAN_LAN</prematch>
  <regex type="pcre2" offset="after_prematch">^-(\w)-\d+\] DESCR=\"(.*)\" IN=(\w+) OUT=(\w+) MAC=(\w{2}:\w{2}:\w{2}:\w{2}:\w{2}:\w{2}):(\w{2}:\w{2}:\w{2}:\w{2}:\w{2}:\w{2}):\w{2}:\w{2} SRC=(\d+\.\d+\.\d+\.\d+) DST=(\d+\.\d+\.\d+\.\d+) LEN=\d+ TOS=\d+ PREC=\w+ TTL=\d+ ID=\d+ PROTO=(\w+) SPT=(\d+) DPT=(\d+)</regex>
  <order>type, uni_rulename, inbound, outbound, intmac, devmac, srcip, dstip, proto, srcprt, dstprt</order>
</decoder>

<decoder name="unifi-lan2wan">
  <prematch>LAN_WAN</prematch>
  <regex type="pcre2" offset="after_prematch">^-(\w)-\d+\] DESCR=\"(.*)\" IN=(\w+) OUT=(\w+) MAC=(\w{2}:\w{2}:\w{2}:\w{2}:\w{2}:\w{2}):(\w{2}:\w{2}:\w{2}:\w{2}:\w{2}:\w{2}):\w{2}:\w{2} SRC=(\d+\.\d+\.\d+\.\d+) DST=(\d+\.\d+\.\d+\.\d+) LEN=\d+ TOS=\d+ PREC=\w+ TTL=\d+ ID=\d+.*?PROTO=(\w+) SPT=(\d+) DPT=(\d+)</regex>
  <order>type, uni_rulename, inbound, outbound, intmac, devmac, srcip, dstip, proto, srcprt, dstprt</order>
</decoder>

<!-- base -->
<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2" offset="after_parent">0\|Ubiquiti\|(.+)\|(\d*\.*\d*\.*\d*)\|(\d+)\|(.+)\|(\d{1,2})\|</regex>
  <order>uni_app, app_version, event_id, type, severity</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <!-- Aug 23 17:55:30 udr7 CEF:0|Ubiquiti|UniFi OS|4.3.9|updates|1|msg=Network has been updated to 9.3.45. -->
  <regex type="pcre2">UniFi OS\|(\d*\.*\d*\.*\d*)\|(\w+)\|(\d)\|msg=(.+)</regex>
  <order>app_version, type, severity, message</order>
</decoder>

<!-- kv start -->
<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIcategory=(\w+)</regex>
  <order>uni_cat</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIsubCategory=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_subcat</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIhost=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_host</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIaccessMethod=(\w+)</regex>
  <order>uni_accessway</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">src=(\d+\.\d+\.\d+\.\d+)</regex>
  <order>srcip</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">msg=(.+)</regex>
  <order>message</order>
</decoder>

<!-- config changes -->
<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIsettingsSection=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_changedsection</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIsettingsEntry=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_changedentry</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIadmin=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_changeagent</order>
</decoder>

<!-- wifi -->
<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIclientAlias=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_clientdev</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIclientIp=(\d+\.\d+\.\d+\.\d+)</regex>
  <order>uni_clientip</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIwifiName=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_ssid</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIWiFiRssi=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_rssi</order>
</decoder>

<!-- threat -->
<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">proto=(\w+)</regex>
  <order>proto</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">spt=(\d+)</regex>
  <order>srcprt</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">dst=(\d+\.\d+\.\d+\.\d+)</regex>
  <order>dstip</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">dpt=(\d+)</regex>
  <order>dstprt</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIrisk=(\w+)</regex>
  <order>uni_risk</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIipsSignature=(.+?)(?=\s(?:UNIFI\w+=|src=|msg=))</regex>
  <order>uni_signature</order>
</decoder>

<decoder name="unifi">
  <parent>unifi</parent>
  <regex type="pcre2">UNIFIipsSignatureId=(\d+)</regex>
  <order>uni_sigid</order>
</decoder>
